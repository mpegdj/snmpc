# MIB Database 작업 정리

이 문서는 **MIB Database(MIB 트리/테이블/표시)** 관련 구현 내용을 정리합니다.

---

## 1) 현재 구현된 기능(요약)

### 1.1 MIB 파일 로드

- **위치**: `SnmpNms.Infrastructure/MibService.cs`
- **기능**: MIB 파일(.mib, .txt) 파싱하여 OID ↔ Name 변환 제공
- **기본 MIB**: sysDescr, sysObjectID, sysUpTime 등 기본 표준 MIB 하드코딩
- **로드 경로**: `D:\git\snmpc\Mib` 또는 실행 파일 기준 `Mib` 폴더

### 1.2 MIB 탭 (현재 상태)

- **위치**: `SnmpNms.UI/MainWindow.xaml` (TabItem Header="Mib")
- **현재 상태**: Todo 메시지만 표시
- **목표**: SNMPc 스타일의 MIB Selection Tree 구현 필요

---

## 2) SNMPc 매뉴얼 요구사항

### 2.1 MIB Selection Tree 구조

- **표준 MIB**: `mgmt` 서브트리 (1.3.6.1.2.1)
- **Private MIB**: `Private` 서브트리 (1.3.6.1.4.1, vendor-specific)
- **Custom Tables**: 사용자 정의 테이블
- **아이콘 구분**:
  - 폴더 아이콘: 서브트리/폴더
  - 테이블 그리드 아이콘: MIB 테이블 정의
  - 스칼라 아이콘: 단일 값

### 2.2 Right-Click 메뉴

- **View Table**: 선택된 디바이스의 MIB 테이블 표시
- **View Graph**: 선택된 디바이스의 MIB 테이블 그래프 표시
- **Insert Table...**: 사용자 정의 테이블 추가
- **Properties...**: MIB 노드 속성 표시

### 2.3 동작 흐름

1. Map Selection Tree에서 하나 이상의 SNMP 디바이스 선택
2. MIB 탭 활성화
3. MIB Selection Tree에서 원하는 테이블 찾기 (mgmt/Private 서브트리 탐색)
4. 테이블 이름에 Right-Click → View Table/View Graph 선택
5. 선택된 디바이스에 대해 해당 MIB 테이블 표시

---

## 3) 구현 계획

### 3.1 MIB 트리 모델

- **파일**: `SnmpNms.UI/Models/MibTreeNode.cs` (신규)
- **속성**:
  - `Name`: MIB 노드 이름
  - `Oid`: OID 문자열
  - `NodeType`: Folder/Table/Scalar/CustomTable
  - `Children`: ObservableCollection<MibTreeNode>
  - `IsExpanded`: 트리 확장 상태

### 3.2 MibService 확장

- **인터페이스 추가**: `IMibService.GetMibTree()` → `MibTreeNode` 반환
- **구현**: `MibService.GetMibTree()` - 로드된 MIB를 트리 구조로 변환
- **트리 구성**:
  - 루트: mgmt, Private, Custom-Tables
  - 각 MIB 파일의 OID를 파싱하여 계층 구조 생성

### 3.3 MIB 탭 UI

- **위치**: `SnmpNms.UI/MainWindow.xaml` (Mib TabItem)
- **레이아웃**: 좌측 TreeView (MIB Selection Tree), 우측 상세 정보 영역
- **TreeView**:
  - HierarchicalDataTemplate으로 계층 구조 표시
  - 아이콘: NodeType에 따라 폴더/테이블/스칼라 아이콘
  - ContextMenu: View Table, View Graph, Insert Table, Properties
- **상세 정보 영역**: 선택된 MIB 노드의 정보 표시 (OID, 설명 등)

### 3.4 Right-Click 메뉴 핸들러

- **View Table**: MIB 테이블 뷰 창 열기 (선택된 디바이스 + MIB 테이블 OID)
- **View Graph**: MIB 그래프 창 열기 (후속 작업)
- **Insert Table...**: 사용자 정의 테이블 추가 다이얼로그 (후속 작업)
- **Properties...**: MIB 노드 속성 다이얼로그 (후속 작업)

### 3.5 MIB 테이블 뷰 창

- **파일**: `SnmpNms.UI/Views/Dialogs/MibTableViewWindow.xaml` (신규)
- **기능**: SNMP WALK을 사용하여 테이블 데이터 표시
- **표시 형식**: DataGrid (행: 인스턴스, 열: 컬럼 OID)
- **동작**: 선택된 디바이스에 대해 MIB 테이블 OID로 WALK 수행

---

## 4) 다음 작업(후속)

- **MIB 파일 파서 개선**: 현재 정규식 기반 단순 파서를 더 정교하게 개선 (SMIv2 문법 지원)
- **MIB 테이블 자동 감지**: OBJECT-TYPE의 SYNTAX가 SEQUENCE OF인 경우 테이블로 인식
- **MIB 그래프 뷰**: 시간에 따른 값 변화를 그래프로 표시
- **Custom Tables 관리**: 사용자 정의 테이블 추가/편집/삭제 기능
- **MIB 노드 검색**: 이름 또는 OID로 검색 기능

---

## 5) 참고 자료

- SNMPc Getting Started PDF: MIB Selection Tree 사용법
- SMIv2 (RFC 2578): MIB 파일 구조 정의
- SNMP MIB 테이블 개념: 행(인스턴스)과 열(컬럼 OID) 구조


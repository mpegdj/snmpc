# MIB View - `nel` child disappear 이슈 정리

## 작성 일시

2025-12-28

## 이슈 한 줄 요약

MIB View에서 `nel (1.3.6.1.4.1.3930)` 하위 노드가 사라지거나 비어 보이고, 일부 노드가 `IMPORTS` 같은 키워드로 잘못 표시되는 현상.

---

## 1) 증상(관찰된 현상)

- `nel (1.3.6.1.4.1.3930)` 노드는 보이는데 **하위 자식 노드가 없음**
- `mve5000` 노드가 **전혀 보이지 않음**
- `mvd5000` 노드가 **"IMPORTS"로 잘못 표시**되는 케이스 존재
- 결과적으로 vendor subtree 탐색이 불가능해짐

---

## 2) 비교 기준(버전)

- **정상(기준)로 간주한 버전**: 커밋 `8042509`
- **문제 발생 버전**: 커밋 `75aa832`

> 상세 비교/깊은 분석은 `Doc/15.mib_tree_bug_analysis.md`에 별도로 정리됨.

---

## 3) 재현 방법(기본 시나리오)

1. 앱 실행
2. MIB 관련 화면(MIB View/Tree)에서 `Private (1.3.6.1.4.1)` → `3930`(=nel) 계열 탐색
3. 아래 중 하나 또는 복합 증상 발생
   - `nel`이 보이지만 자식이 비어 있음
   - `mve5000`이 안 보임
   - `mvd5000`이 `IMPORTS`로 표시됨

---

## 4) 원인 후보(가설) 요약

이 이슈는 “UI에서 트리가 접히거나 선택이 날아감” 같은 단순 UI 문제가 아니라,
**(A) MIB 파싱 결과가 잘못 들어오거나, (B) 파싱된 결과를 트리로 변환하는 과정에서 유효 이름/노드를 제거하거나, (C) 키워드가 OID 이름으로 잘못 등록되는 문제**일 가능성이 큼.

### 4.1 과도한 필터링으로 인한 매핑 손실

아래 같은 로직이 있으면, 정상 MIB 이름까지 제거되어 `_oidToName` / `_nameToOid`가 깨질 수 있음.

- `Register()` 단계에서 특정 조건(예: 소문자 시작만 허용)으로 등록 자체를 막음
- `GetMibTree()`에서 `_oidToName`을 정리하는 단계가 있는데, 조건이 과도해 유효 항목 제거

**결과**:

- 부모(예: `nel`)은 남아도, 자식(예: `mve5000`/`mvd5000` 및 그 아래)이 매핑에서 사라져
  트리 생성 시 자식이 안 붙거나 “숫자 세그먼트만” 남는 현상 발생 가능

### 4.2 정규식 파서 제약(대소문자/키워드/문법)

MIB 파일 파싱이 정규식 기반이면 아래에 취약할 수 있음:

- 이름이 대문자로 시작하는 정의를 무시
- `IMPORTS/EXPORTS/FROM/BEGIN/END` 같은 키워드 라인이 “정의”로 오인되어 이름으로 등록
- MIB 파일이 여러 줄/주석/복잡한 문법을 포함할 때 매칭 실패

**결과**:

- `mvd5000`이 `"IMPORTS"`로 잘못 보이는 현상은 “키워드 라인을 잘못 파싱/등록”했을 가능성을 강하게 시사

### 4.3 트리 생성 로직의 복잡화(중간 세그먼트 이름 치환/업데이트)

트리 생성(`BuildTreeFromOids`)에서:

- 중간 세그먼트까지 `_oidToName`에서 이름을 찾아 치환
- 기존에 생성된 노드 이름을 업데이트

같은 로직이 들어가면, 앞 단계 매핑이 조금만 틀려도 트리 결과가 크게 흔들릴 수 있음.

---

## 5) 빠른 확인 체크리스트(디버깅 포인트)

### 5.1 파싱 결과 확인(매핑이 살아있는지)

- `_oidToName`에 아래가 존재하는지 확인
  - `1.3.6.1.4.1.3930` → `nel`
  - `1.3.6.1.4.1.3930.36` → `mve5000`
  - `1.3.6.1.4.1.3930.37` → `mvd5000`
- 키워드가 이름으로 들어간 흔적이 있는지 확인
  - 예: 어떤 OID가 `"IMPORTS"`로 매핑되어 있지는 않은가?

### 5.2 트리 생성 결과 확인

- `GetMibTree()` 직후 `Private` subtree에서
  - `nel` 노드가 생성되는지
  - `nel.Children`에 `mve5000/mvd5000`가 붙는지

---

## 6) (권장) 수정 방향

### 6.1 필터링은 “최소한”으로

- `IMPORTS/EXPORTS/...` 같은 **명확한 키워드만 제거**
- “소문자 시작만 허용” 같은 공격적인 규칙은 제거/완화

### 6.2 정규식은 넓게, 제거는 좁게

- 파싱 정규식은 대소문자/하이픈/언더스코어 등을 최대한 허용
- 대신 “등록 단계”에서 키워드/빈 문자열 같은 확실한 잡음을 제거

### 6.3 트리 생성은 단순화(원본 보존)

- 중간 세그먼트는 숫자 세그먼트로 두고(안정),
- 리프(마지막)만 name을 붙이는 방식이 안정적일 수 있음

---

## 7) 테스트 체크리스트(수정 후 검증)

- [ ] `nel`이 보이는가?
- [ ] `nel` 하위에 `mve5000`이 보이는가?
- [ ] `nel` 하위에 `mvd5000`이 보이는가?
- [ ] `mvd5000`이 `"IMPORTS"`로 보이지 않는가?
- [ ] `Private` 아래 다른 vendor subtree도 정상 표시되는가?

---

## 8) 관련 문서

- 더 상세한 분석/비교/코드 스니펫/시나리오: `Doc/15.mib_tree_bug_analysis.md`

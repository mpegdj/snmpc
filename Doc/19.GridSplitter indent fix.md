# 19. GridSplitter / Tree indent fix + 복구 작업 전체 정리

## 목표

- **MIB 파싱/필터링(`MibService.cs`)은 절대 건드리지 않고**, 유실된 작업(Discovery GUI + Walk 개선 + OID `.0` 처리)을 복구
- VS Code 스타일 UX:
  - **좌측 Sidebar(GridSplitter 드래그) 시 빈 공간 없이 Stretch**
  - **MIB Tree depth 들여쓰기(Indent) 더 촘촘하게**

---

## 1) 브랜치/커밋 복구 (삭제된 backup 살리기)

- 상황: `backup/before-reset-...` 브랜치 삭제 + reset/checkout로 커밋이 “사라진 것처럼” 보임
- 조치:
  - `git reflog --all`로 **커밋이 살아있는지 확인**
  - `1075684`를 기준으로 복구용 포인터 생성:
    - `rescue/backup-20251228` (삭제된 backup 스냅샷)
  - `75aa832`가 “사라진 것”이 아니라 **현재 브랜치 히스토리에만 없던 것**임을 확인:
    - `git cat-file -t 75aa832` → commit
    - `git branch --contains 75aa832` → `rescue/backup-20251228`
  - `75aa832`를 보기 위한 포인터 브랜치 생성:
    - `rescue/nel-child-disappear` → `75aa832`

---

## 2) “안전 복구” 전략 (MIB 파싱/필터링 금지 준수)

- 원칙:
  - `MibService.cs` 등 MIB 파싱/필터링 파일은 **절대 merge/cherry-pick로 통째로 가져오지 않음**
  - 복구는 **파일 단위 restore** + staged 파일 목록 검증으로 진행
- 적용:
  - 작업 브랜치: `recover/discovery-gui-gonextwalk`
  - `rescue/backup-20251228`에서 아래 파일만 가져옴:
    - `SnmpNms.UI/Views/Dialogs/DiscoveryPollingAgentsDialog.xaml.cs`
    - `SnmpNms.UI/Views/Dialogs/DiscoveryProgressDialog.xaml`
    - `SnmpNms.UI/Views/Dialogs/DiscoveryProgressDialog.xaml.cs`
    - `SnmpNms.Infrastructure/SnmpClient.cs`

---

## 3) 빌드 에러 해결 (Discovery → UiSnmpTarget 의존성)

- 증상: `DiscoveryPollingAgentsDialog.xaml.cs`에서 `UiSnmpTarget.SysObjectId` 사용으로 컴파일 오류(CS0117)
- 조치:
  - `SnmpNms.UI/Models/UiSnmpTarget.cs`에 `SysObjectId` 속성 1개 추가
  - 목적: Discovery에서 sysObjectId 보관(기기 식별/후속 기능)
  - 주의: **MIB 파싱/필터링과 무관한 변경**

---

## 4) SNMP Test의 OID `.0` 문제(스칼라 인스턴스) 해결

- 증상(요약):
  - GET은 `.0`이 자동으로 안 붙어서 혼란
  - GET-NEXT는 결과 OID를 UI에 다시 넣어서 `.0`이 붙어보임
  - WALK는 `.0` 인스턴스 OID로 실행 시 실패/혼란
- 해결:
  - `75aa832 (nel child disappear)`에서 검증된 로직을 **부분 포팅**
    - WALK 입력이 `.0`이면 스칼라로 보고 `.0` 제거 후 WALK 실행
    - MIB 트리 클릭 시 스칼라면 `.0`을 붙여 SNMP Test 입력 OID를 인스턴스 형태로 제공
  - 커밋:
    - `fix(snmp): scalar .0 normalization for walk + mib selection`

---

## 5) Walk 개선(서브트리 범위 + 스칼라 보정)

- 개선점:
  - `SnmpClient.WalkAsync`에서 `WalkMode.WithinSubtree` 사용 → 형제 OID로 새는 현상 방지
  - 결과가 0이면 `Get` 1회로 스칼라 값을 보정(fallback)

---

## 6) Discovery Progress / Result UX 개선(복구된 내용)

- `DiscoveryProgressDialog` UI 2열 레이아웃(좌: 로그, 우: 디바이스 리스트 확장)
- 로그/필터 UX 일부 개선(placeholder 등)
- `DiscoveryPollingAgentsDialog` 결과 반영 로직 단순화(선택된 디바이스 추가 중심)

---

## 7) main 머지(복구 브랜치 → main)

- `recover/discovery-gui-gonextwalk`에서 빌드/동작 확인 후 main으로 머지
- main에 반영된 파일(요약):
  - `SnmpNms.Infrastructure/SnmpClient.cs`
  - `SnmpNms.UI/MainWindow.xaml.cs`
  - `SnmpNms.UI/Models/UiSnmpTarget.cs`
  - `SnmpNms.UI/Views/Dialogs/Discovery*`
  - 문서: `Doc/18.recover_discovery_gonetxt.md`
- 주의: MIB 파싱/필터링 파일(`MibService.cs`) **머지 대상에서 제외**

---

## 8) GridSplitter 드래그 시 Sidebar 빈 공간 문제(VS Code 스타일)

- 증상: Editor/Sidebar 사이 GridSplitter 드래그 시 Sidebar 폭이 늘지 않고 빈 공간이 보임
- 원인: `SnmpNms.UI/Views/Sidebar.xaml`에 `Width="280"` 고정
- 조치:
  - `Width="280"` 제거
  - `HorizontalAlignment="Stretch"`로 변경
- 결과: VS Code처럼 **드래그한 폭만큼 Sidebar가 꽉 참**

---

## 9) MIB Tree depth 들여쓰기(Indent) 더 촘촘하게

- 질문: “WPF 표준이냐?” → 기본 템플릿이 들여쓰기 픽셀을 갖고 있어 기본값처럼 보이는 것
- 조치:
  - `SnmpNms.UI/Resources/VSCodeTheme.xaml`의 `VSCodeTreeViewItemStyle`에 템플릿 추가
  - 레벨당 indent를 `VSCodeTreeIndent`로 제어
  - 최종: `VSCodeTreeIndent = 8px`
- 커밋:
  - `ui: reduce tree indent`

---

## 현재 상태

- main은 `origin/main` 대비 **ahead 상태**(로컬 커밋 존재)이며 필요 시 push 진행
- “Discovery progress 시간 표시([xx.xx])”는 중요도 낮아서 **후속 개선으로 보류**
